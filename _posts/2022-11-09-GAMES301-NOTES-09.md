---
layout: article
title: GAMES301课程笔记09-基于调和映射的高质量形变
tags: ["CG", "GAMES301", "Geometry Processing"]
key: GAMES301-09
aside:
  toc: true
sidebar:
  nav: GAMES301
---

> 这个系列是GAMES301-曲面参数化([GAMES 301: Surface Parameterization](http://staff.ustc.edu.cn/~renjiec/GAMES301/index.html))的同步课程笔记。课程内容涉及曲面参数化的基本理论与问题描述、面向离散网格的参数化、基于基函数表示的连续参数化、共形参数化、曲面参数化的应用等。本节课主要介绍基于调和映射的网格形变技术。
<!--more-->

## Deformation

**几何形变(deformation)**和参数化都可以看做是计算某种映射，它们的主要区别在于参数化一般是高维到低维的映射，而几何形变则主要是考虑同样维度上的映射。

<div align=center>
<img src="https://i.imgur.com/ukPB4bp.png" width="80%">
</div>

### Applications

几何形变在图形学尤其是计算机动画领域有着大量的应用。以传统二维关键帧动画为例，动画的制作过程往往是由原画师先画出角色在关键帧上的形态，这一过程相当于对已有的形状进行**变形(shape deformation)**。接着动画师会绘制关键帧之间的填充帧，这一过程相当于对形状进行**插值(shape interpolation)**。几何形变技术可以辅助整个动画制作流程，从而大大减少关键帧动画制作的成本。

<div align=center>
<img src="https://i.imgur.com/9GxVLpT.png" width="80%">
</div>

因此几何形变技术在工业界有着大量的需求，很多建模动画软件都需要实现相关的功能使用户实现直观、快速且高质量的造型。

<div align=center>
<img src="https://i.imgur.com/rOFRoOn.png" width="80%">
</div>

### Previous Work

目前几何形变技术注意包括**基于网格(mesh-based)**的方法以及**无网格(meshless)**方法两大类。基于网格的方法本质是构造分片线性映射，无法保证映射的光滑性；而无网格方法则会直接使用光滑基函数，因此这类方法天生是光滑的。不过现有无网格方法都存在着自身的缺陷，比如说无法保证无翻转单射、无法保证几何扭曲、无法对位置施加约束或者无法保持原形状等。

<div align=center>
<img src="https://i.imgur.com/f5Lilho.png" width="80%">
</div>

### Planar Map

对于二维平面映射，记$f: \Omega_1 \rightarrow \Omega_2$将点$(x, y)$映射到$(u, v)$上：

$$
\begin{bmatrix}
x \\ y
\end{bmatrix}
\rightarrow
\begin{bmatrix}
u(x, y) \\ v(x, y)
\end{bmatrix}
$$

对$f$的Jacobian矩阵进行SVD可以得到：

$$
J = 
\begin{bmatrix}
u_x & u_y \\
v_x & v_y \\
\end{bmatrix}
=
U
\begin{bmatrix}
\sigma_1 & 0 \\
0 & \sigma_2 \\
\end{bmatrix}
V
$$

其中$\sigma_1 \geq \sigma_2 \geq 0$分别表示点$(x, y)$处两个主方向上的伸缩。

对于二维平面我们还可以使用复数来进行表示，此时$f$即为复数域到复数域的映射，其在 $z=x + i \ y$ 处的导数为：

$$
f_z = \frac{1}{2} \bigg( u_x + v_y + i \ (v_x - u_y) \bigg)
$$

$$
f_{\bar{z}} = \frac{1}{2} \bigg( u_x - v_y + i \ (v_x + u_y) \bigg)
$$

而且这两个导数与奇异值之间存在关系：

$$
\sigma_1 = \vert f_z \vert + \vert f_{\bar{z}} \vert
$$

$$
\sigma_2 = \big\vert \vert f_z \vert - \vert f_{\bar{z}} \vert \big\vert
$$

<div align=center>
<img src="https://i.imgur.com/7Lz0beg.png" width="80%">
</div>

利用奇异值或是复数导数可以度量形变的几何扭曲。对于共形映射一般要求两个奇异值尽可能相等，而对于等距映射则会要求两个奇异值都接近于1。

<div align=center>
<img src="https://i.imgur.com/RFHemKh.png" width="80%">
</div>

## Planar Harmonic Deformation

调和映射是几何形变中非常常用的工具。在二维平面上调和映射满足Laplace方程，它具有很多优良的数学性质包括光滑性(无穷阶可导)、仅在边界上取极值、以及可以通过边界条件唯一确定。

<div align=center>
<img src="https://i.imgur.com/tW7He3P.png" width="80%">
</div>

### Bounded Distortion Mapping

在设计映射函数时我们一般会要求几何扭曲有界。由于调和映射可以由边界条件唯一确定，因此一个很自然的想法是能否通过控制边界上的几何扭曲来保证全局上的几何扭曲有界。

<div align=center>
<img src="https://i.imgur.com/B7LNMrZ.png" width="80%">
</div>

实际上对于调和映射我们有如下定理保证调和映射在全局上的几何扭曲有界：

<div align=center>
<img src="https://i.imgur.com/A2cc4uA.png" width="80%">
</div>

同时回忆调和映射可以分解为全纯映射与反全纯映射的和。利用柯西复中心坐标可以对两个映射进行分解，分别用两个cage来控制图形的变化。这样就只需要控制

<div align=center>
<img src="https://i.imgur.com/xcQDJXc.png" width="80%">
<img src="https://i.imgur.com/UsTzfJn.png" width="80%">
</div>

### Bounded Distortion Harmonic Deformation

此时整个计算过程就相当于求解一个约束优化问题。

<div align=center>
<img src="https://i.imgur.com/7jR13kG.png" width="80%">
</div>

接下来要求整个映射在全局上扭曲有界，此时需要在边界上进行验证。

<div align=center>
<img src="https://i.imgur.com/Wm1tJk0.png" width="80%">
</div>

基于上面的算法可以得到很高质量的变形效果。

<div align=center>
<img src="https://i.imgur.com/ALRZxQv.png" width="80%">
<img src="https://i.imgur.com/OLKejAD.png" width="80%">
<img src="https://i.imgur.com/lDOt9sV.png" width="80%">
</div>

## Harmonic Volumetric Deformation

## Reference

- [Lecture 09：基于调和映射的高质量形变](https://www.bilibili.com/video/BV18T411P7hT?p=9&vd_source=7a2542c6c909b3ee1fab551277360826)