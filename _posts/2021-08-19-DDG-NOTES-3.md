---
layout: article
title: DDG课程笔记3-Laplace算子
tags: ["DDG", "CG"]
key: DDG-3
aside:
  toc: true
sidebar:
  nav: DDG
---

> 这个系列是对CMU离散微分几何课程([CMU CS 15-458/858: Discrete Differential Geometry](https://brickisland.net/DDGSpring2021/))的总结和回顾。本节我们介绍几何处理中最实用的工具-Laplace算子。
<!--more-->

## Overview

**Laplace算子(Laplacian)**在不同的领域里都有非常重要的应用。在物理学中我们可以通过Laplace算子来描述不同的物理现象：

<div align=center>
<img src="https://i.imgur.com/mF7mk2s.png" width="80%">
</div>

在几何处理中Laplace算子描述了网格的局部信息，因此也称为微分坐标(differential coordinates)。同时，Laplace算子也和平均曲率以及网格的频率信息有着紧密的联系：

<div align=center>
<img src="https://i.imgur.com/kVsi4Sa.png" width="80%">
</div>

欧式空间中的Laplace算子可以定义为函数二阶导数的和：

$$
\Delta u = \sum_{i=1}^n \frac{\partial^2 u}{\partial x_i^2}
$$

因此Laplace算子描述了函数在局部邻域内的性质，我们可以通过Laplace算子来计算函数的极值点以及曲率：

<div align=center>
<img src="https://i.imgur.com/SKszyKt.png" width="40%">
<img src="https://i.imgur.com/oSa7sBw.png" width="40%">
</div>

在图论中，Laplace算子则描述了节点和它相邻节点平均值的相对关系：

$$
(L u)_i = \big( \frac{1}{\text{deg}(i)} \sum_{ij \in E} u_j \big) - u_i
$$

在社交网络中这表示每一个人总是与和他相关的人具有相似的属性(观点)。

<div align=center>
<img src="https://i.imgur.com/eO9Hsga.png" width="30%">
</div>

### Definitions

尽管Laplace算子在不同的领域中有着不同的定义，我们可以看出Laplace算子描述了一个对象和它相邻对象平均值的关系。同时，针对Laplace算子的不同性质也可以给出很多等价的定义。考虑Laplace算子可以看做是偏导数的和，这里给出Laplace算子在流形上的定义：

$$
\Delta u = \sum_{i=1}^n \sum_{j=1}^n \frac{1}{\sqrt{\det (g)}} \frac{\partial}{\partial x_i} \Big( \sqrt{\det (g)} (g^{-1})_{ij} \frac{\partial}{\partial x_j} u \Big)
$$

<div align=center>
<img src="https://i.imgur.com/NcFdnqU.png" width="35%">
</div>

可以验证在欧式空间下上式会退化为我们熟悉的二阶导数和的形式$\Delta u = \sum_{i=1}^n \frac{\partial^2 u}{\partial x_i^2}$。尽管这个式子十分复杂，在实际的计算中基本不会直接使用它。

对函数$u$进行泰勒展开并保留前两项得到：

$$
u(x_0 + w) \approx u(x_0) + \langle \nabla u(x_0), w \rangle + \frac{1}{2} \langle \nabla^2 u(x_0) w, w \rangle
$$

<div align=center>
<img src="https://i.imgur.com/R3QMvci.png" width="70%">
</div>

不难发现Laplace算子等于Hessian矩阵的迹：

$$
\Delta u = \frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2} = \text{tr} (\nabla^2 u)
$$

在曲面上使用**协变导数(covariant derivative)**来代替欧式坐标中的导数，得到：

$$
\nabla_{X, Y}^2 u (X, Y) = (\nabla_X du) (Y)
$$

此时Laplace算子仍然等于Hessian矩阵的迹：

$$
\Delta u = \text{tr}(\nabla^2 u) = \text{tr}(\nabla du)
$$

Laplace算子还可以定义为梯度的散度，此时表达式为：

$$
\Delta u = \nabla \cdot \nabla u
$$

<div align=center>
<img src="https://i.imgur.com/qkmJKuW.png" width="41%">
<img src="https://i.imgur.com/UG2lS4F.png" width="30%">
</div>

此外，我们还可以通过随机游走(**布朗运动(Brownian motion)**)来认识Laplace算子。对于单一粒子的随机游走其状态可由热传导方程进行刻画，带入初始条件$\phi$得到：

$$
\left\{
\begin{aligned}
&\frac{d}{dt} u = \Delta u \\
&u \vert_{t=0}  = \phi
\end{aligned}
\right.

\Rightarrow

u(t, x) = \int_\Omega k_t(x, y) \phi(y) dy = \mathbb{E}[\phi (X_t)]
$$

其中$k_t(x, y)$称为**热核(heat kernel)**，表示从具有单位温度的热源$x$经时间$t$传播到$y$处时的温度，这里可以认为是粒子从$x$出发在$t$时刻位于$y$的概率密度；$X_t$表示随机游走的粒子在$t$时刻的位置。


最后来介绍Laplace算子与**Dirichlet能量(Dirichlet energy)**的关系。定义Dirichlet能量为：

$$
E(u) = \int_M \vert \nabla u \vert^2 dA = - \int_M u \Delta u dA = - \langle \langle \Delta u, u \rangle \rangle
$$

<div align=center>
<img src="https://i.imgur.com/afz2P6S.png" width="40%">
</div>

Dirichlet能量描述了函数的光滑程度：Dirichlet能量越小表示函数越光滑、变化越平稳；Dirichlet能量越大表示函数越粗糙、变化越剧烈。同时可以证明最小化Dirichlet能量相当于求解Laplace方程：

$$
u = \arg \min E(u) \Leftrightarrow \Delta u = 0
$$

### Properties

Laplace算子有非常丰富的性质，这里只介绍一些比较常用的性质：

- 线性性：$\Delta (f + \alpha g) = \Delta f + \alpha \Delta g$
- 常值函数满足$\Delta \alpha = 0$
- 对刚体变换保持不变
- 可交换性：对等距映射$\eta$满足$\eta \circ \Delta = \Delta \circ \eta$
- 自伴随：$\int_M f \Delta g dA = \int_M g \Delta f dA$
- (半)负定：$\int_M f \Delta f dA \leq 0$

值得一提的是Laplace算子还具有**谱性质(spectral properties)**。类似于实对称矩阵的特征向量，Laplace算子存在正交的特征函数：

$$
\Delta \phi_i = \lambda_i \phi_i
$$

$$
\int_M \Vert \phi \Vert dA = 1
$$

其中$0 \geq \lambda_1 \geq \lambda_2 ...$。上式表明可以把Laplace算子看做是无穷维的(半)负定矩阵，特征函数对应矩阵的特征向量。此外特征函数构成了函数空间中的基，因此可以对任意函数$f$进行分解：

$$
f = \sum_i \alpha_i \phi_i
$$

<div align=center>
<img src="https://i.imgur.com/oOLU36y.png" width="40%">
</div>

利用特征函数分解还可以将Dirichlet能量写成级数的形式：

$$
E(f) = \int_M \vert \nabla f \vert^2 dA = -\int_M f \Delta f dA = \sum_i \alpha_i^2 (-\lambda_i)
$$

## Discretization via DEC

接下来推导离散Laplace算子的表达式，这里我们使用离散外微分来进行推导。首先给出光滑曲面上Laplace算子的表达式：

$$
\Delta u = \star d \star d u
$$

使用外微分形式的好处在于我们可以直接进行离散，得到网格上的Laplace算子：

$$
\Delta u = \star_0^{-1} d_0^T \star_1 d_0 u
$$

上式表明我们可以直接使用我们已经推导的离散微分算子来构造出Laplace算子。实际上我们还可以把它们写成更紧凑的形式：对于0-form $u$，它的离散外微分$du$等于顶点函数值的差：

$$
(du)_{ij} = \int_{e_{ij}} du = \int_{\partial e_{ij}} u = u_j - u_i
$$

<div align=center>
<img src="https://i.imgur.com/wGxYZKH.png" width="35%">
</div>

在$du$上使用Hodge star算子等于将$du$缩放到dual边$e_{ij}^\star$上：

$$
(\star du)_{ij} = \frac{\vert e_{ij}^\star \vert}{\vert e_{ij} \vert} (u_j - u_i)
$$

<div align=center>
<img src="https://i.imgur.com/1T7Eq36.png" width="35%">
</div>

其中，

$$
\frac{\vert e_{ij}^\star \vert}{\vert e_{ij} \vert} = \frac{1}{2} (\cot \alpha_j + \cot \beta_j)
$$

<div align=center>
<img src="https://i.imgur.com/l4rnQAN.png" width="40%">
</div>

接着对dual 1-form $(\star du)_{ij}$进行微分，相当于把dual cell边界上的积分加起来，得到dual 2-form $(d \star du)_i$：

$$
(d \star du)_i = \int_{C_i} d \star du = \int_{\partial C_i} \star du = \sum_j \frac{\vert e_{ij}^\star \vert}{\vert e_{ij} \vert} (u_j - u_i) = \frac{1}{2} \sum_j (\cot \alpha_j + \cot \beta_j) (u_j - u_i)
$$

<div align=center>
<img src="https://i.imgur.com/3ryuVw3.png" width="35%">
</div>

此时我们得到的dual 2-form $(d \star du)_i$ 与0-form $(\star d \star du)_i$ 只相差dual cell的面积，相当于是 $(\star d \star du)_i$ 在dual cell上面的积分。通常情况下我们会把dual cell的面积提出来单独处理，进而定义离散Laplace算子为：

$$
(\Delta u)_i = \frac{1}{2} \sum_j (\cot \alpha_j + \cot \beta_j) (u_j - u_i)
$$

上式称为**cotan-Laplace算子(cotan Laplacian)**。注意到cotan-Laplace算子与平均曲率向量$(HN)_i$只相差一个符号，因此在有些资料中也会直接将平均曲率向量$(HN)_i$定义为Laplace算子，此时的Laplace算子为(半)正定。

## Applications

### Poisson Equation

### Boundary Conditions

## Reference

- [CHAPTER 6: The Laplacian](http://www.cs.cmu.edu/~kmcrane/Projects/DDG/paper.pdf#page=101)
- [Laplace-Beltrami: The Swiss Army Knife of Geometry Processing](http://ddg.cs.columbia.edu/SGP2014/LaplaceBeltrami.pdf)