---
layout: article
title: GAMES104课程笔记22-GPU-Driven Geometry Pipeline-Nanite
tags: ["CG", "GAMES104", "Game Engine"]
key: GAMES104-22
aside:
  toc: true
sidebar:
  nav: GAMES104
---

> 这个系列是GAMES104-现代游戏引擎：从入门到实践([GAMES 104: Modern Game Engine-Theory and Practice](https://games104.boomingtech.com/en/))的同步课程笔记。本课程会介绍现代游戏引擎所涉及的系统架构、技术点以及引擎系统相关的知识。本节课主要介绍GPU驱动的几何管线与Nanite技术。
<!--more-->

## Introduction

### Traditional Rendering Pipeline

Nanite是虚幻5引擎中提出的虚拟几何系统用来实现渲染超高精度的网格。要理解Nanite首先要回顾一下经典渲染管线：当我们从CPU端发出渲染指令时会首先由CPU来准备各种渲染所需的资源，然后GPU会接收这些数据并计算实际的着色。这种模式的缺陷在于CPU可能无法跟上GPU的计算速度，而且CPU的算力会浪费在准备渲染素材这一过程中。

<div align=center>
<img src="https://i.imgur.com/rAwzzPc.png" width="80%">
</div>

随着渲染场景的复杂度逐渐提升，CPU端的计算开销会成为整个渲染过程的瓶颈。

<div align=center>
<img src="https://i.imgur.com/SBDI6x7.png" width="80%">
<img src="https://i.imgur.com/y1HYP0E.png" width="80%">
</div>

### Compute Shader

为了提升渲染效率人们开发出了**compute shader**这样的技术，其核心在于把过去只能在CPU端执行的通用计算转移的GPU端，从而节约掉大量的CPU到GPU端的通信开销。

<div align=center>
<img src="https://i.imgur.com/29Cc3Kd.png" width="80%">
</div>

### Graphics API

在图形API层面上过去只能一次绘制一个网格，而现代图形API则支持在一次DrawCall中同时绘制多个网格。

<div align=center>
<img src="https://i.imgur.com/5Kx1jQi.png" width="80%">
</div>

### GPU Driven Rendering Pipeline

总结一下，现代GPU驱动的渲染管线核心思想在于把CPU端的计算直接移动到GPU端，同时渲染所需的数据也会直接由GPU进行加载。在理想情况下CPU端只负责发出绘制指令，一切数据加载和计算都由GPU端直接完成。

<div align=center>
<img src="https://i.imgur.com/JRByllG.png" width="80%">
</div>

## GPU Driven Pipeline in Assassins Creed

## Occlusion Culling for Camera and Shadow

## Visibility Buffer

## Virtual Geometry - Nanite

### Overview

### Geometry Representation

### Rendering

### Virtual Shadow Map

### Streaming and Compression

## Reference

- [Lecture 22：GPU-Driven Geometry Pipeline-Nanite (Part I)](https://www.bilibili.com/video/BV1Et4y1P7ro/?spm_id_from=333.788&vd_source=7a2542c6c909b3ee1fab551277360826)
- [Lecture 22：GPU-Driven Geometry Pipeline-Nanite (Part II)](https://www.bilibili.com/video/BV17G4y1x7VX/?spm_id_from=333.788&vd_source=7a2542c6c909b3ee1fab551277360826)