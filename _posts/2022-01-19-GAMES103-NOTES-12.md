---
layout: article
title: GAMES103课程笔记12-Smoothed Particle Hydrodynamics
tags: ["GAMES103", "CG"]
key: GAMES103-12
aside:
  toc: true
sidebar:
  nav: GAMES103
---

> 这个系列是GAMES103：基于物理的计算机动画入门([GAMES 103: Intro to Physics Based Animation](http://games-cn.org/games103/))的同步课程笔记。本课程是计算机动画的入门课程，着重介绍各种基于物理的动画仿真模拟技术。本节课主要介绍SPH在流体仿真中的应用。
<!--more-->

## SPH Model

**光滑粒子流体动力学(smoothed particle hydrodynamics, SPH)**是一种无网格的流体仿真方法。和前面课程中介绍过的方法相比，SPH是一种Lagrangian视角下的模拟方法。在SPH中我们通过大量的粒子和它们携带的物理量(速度、压强、质量)来描述流体的运动。

<div align=center>
<img src="https://i.imgur.com/sCYlSBY.png" width="80%">
</div>

### Smoothed Interpolation

对于流场中的任意位置，SPH通过对它附近粒子求平均的方式来估计该处的物理量。最简单的方法是对半径$R$范围内的所有粒子求平均值。

<div align=center>
<img src="https://i.imgur.com/JXpPIH9.png" width="70%">
</div>

显然这种直接进行平均的方式存在一些缺陷，比如说它没有考虑到粒子的分布。以下图为例，尽管黄颜色的粒子数量比较多，但它们的分布却只集中在一个小范围内，在进行估计时我们不应该过多地考虑这些集中在一起的粒子。

<div align=center>
<img src="https://i.imgur.com/HUJSNbm.png" width="70%">
</div>

因此更好的方法是使用加权的方式来计算平均。假设每个粒子都具有一定的体积$V_j$，我们可以利用体积来对不同粒子携带的物理量进行加权。

<div align=center>
<img src="https://i.imgur.com/Es4ZRPi.png" width="70%">
</div>

但是这种加权方法仍然有一些问题，实际上利用体积进行加权后得到的函数可能是不够光滑的。考虑红色和绿色两个位置的函数值，尽管它们在空间上是临近的但由于绿色位置考虑了更多的粒子，它的函数值可能要比红色位置大得多。

<div align=center>
<img src="https://i.imgur.com/3HmcDGL.png" width="70%">
</div>

因此在SPH中利用**核函数(kernel)**来做进一步的加权。当粒子离计算位置比较远时它的权重会比较低，而当粒子距离计算位置比较近时则会具有相对较高的权重。

<div align=center>
<img src="https://i.imgur.com/rCTSoyM.png" width="70%">
</div>

### Particle Volume Estimation

那么怎么计算粒子的体积呢？实际上我们可以通过类似的方式来更新粒子的体积。对于每个单独的粒子，它的体积由质量除以密度来表示。当粒子不断运动时空间中的粒子分布会发生变化，因此同样可以通过加权平均的方法来估计当前时刻粒子的密度，进而更新粒子的体积。

<div align=center>
<img src="https://i.imgur.com/wf8NILJ.png" width="70%">
</div>

将两个更新步骤结合起来就得到了SPH的更新算法：

<div align=center>
<img src="https://i.imgur.com/VjsfIY5.png" width="70%">
</div>

### Smoothing Kernel

最后我们来考虑核函数。在SPH中最常用的核函数为**smoothing kernel**：

<div align=center>
<img src="https://i.imgur.com/2vKG1Og.png" width="80%">
</div>

使用核函数的另一个好处在于我们可以把对流场的求导转换为对核函数的求导。这里我们假设每个粒子携带的物理量和它的体积为常量，这样流场的导数为核函数导数的加权和：

<div align=center>
<img src="https://i.imgur.com/NgKKeKL.png" width="70%">
</div>

而核函数的导数可以显式计算，比如说smoothing kernel的梯度和Laplacian为：

<div align=center>
<img src="https://i.imgur.com/L6TBZ58.png" width="70%">
</div>

<div align=center>
<img src="https://i.imgur.com/2FUtuNS.png" width="70%">
</div>

## SPH-based Fluids

## Reference

- [Lecture 12: SPH and Position Based Fluids](https://www.bilibili.com/video/BV12Q4y1S73g?p=12)