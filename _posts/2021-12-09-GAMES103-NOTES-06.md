---
layout: article
title: GAMES103课程笔记06-Constraint Approaches
tags: ["GAMES103", "CG"]
key: GAMES103-06
aside:
  toc: true
sidebar:
  nav: GAMES103
---

> 这个系列是GAMES103：基于物理的计算机动画入门([GAMES 103: Intro to Physics Based Animation](http://games-cn.org/games103/))的同步课程笔记。本课程是计算机动画的入门课程，着重介绍各种基于物理的动画仿真模拟技术。本节课主要介绍布料模拟中的约束方法。
<!--more-->

## Position Based Dynamics

布料的力学特征之一是当它拉伸到一定程度后抵抗拉伸的刚度会变得非常大，因此在进行仿真时需要增加弹簧的刚度。但仅仅增加弹簧刚度会带来新的问题：对于显式积分而言过大的刚度会导致数值不稳定性，而对于隐式积分则容易造成系统的病态(ill-conditioned)。为了解决这些问题我们往往需要缩短时间步长或是增加迭代次数，但这种做法又增加了计算的复杂度，降低了仿真的效率。

### A Single Spring

我们可以通过对弹簧的位移进行约束来解决这样的问题。以单根弹簧为例，假设它的初始长度为$L$且刚度无穷大，则弹簧两端的位移需要满足约束：

$$
\phi (\mathbf{x}) = \Vert \mathbf{x}_i - \mathbf{x}_j \Vert - L = 0
$$

当弹簧不满足约束时我们需要调整两端的位置来保证弹簧的长度仍然等于原长$L$：

<div align=center>
<img src="https://i.imgur.com/0Oxfk0X.png" width="60%">
</div>

这样我们就可以构造一个优化问题：

$$
\begin{aligned}
\{ \mathbf{x}_i^\text{new}, \mathbf{x}_j^\text{new} \} &= \arg \min \frac{1}{2} \bigg( m_i \Vert \mathbf{x}_i^\text{new} - \mathbf{x}_i \Vert^2 + m_j \Vert \mathbf{x}_j^\text{new} - \mathbf{x}_j \Vert^2 \bigg) \\
& \text{s. t.} \ \ \phi (\mathbf{x}) = 0
\end{aligned}
$$

从几何的角度上来看，求解这个优化问题相当于把点$\mathbf{x} = \{ \mathbf{x}_i, \mathbf{x}_j \}$投影到满足约束的区域$\Omega = \{ \mathbf{x}: \phi(\mathbf{x}) = 0 \}$上，并且使得投影过程的能量消耗最小。

<div align=center>
<img src="https://i.imgur.com/bFcSAP1.png" width="60%">
</div>

求解这个优化问题可以得到更新后的端点位置：

$$
\mathbf{x}_i^\text{new} = \mathbf{x}_i - \frac{m_j}{m_i + m_j} (\Vert \mathbf{x}_i - \mathbf{x}_j \Vert - L) \frac{\mathbf{x}_i - \mathbf{x}_j}{\Vert \mathbf{x}_i - \mathbf{x}_j \Vert}
$$

$$
\mathbf{x}_j^\text{new} = \mathbf{x}_j + \frac{m_i}{m_i + m_j} (\Vert \mathbf{x}_i - \mathbf{x}_j \Vert - L) \frac{\mathbf{x}_i - \mathbf{x}_j}{\Vert \mathbf{x}_i - \mathbf{x}_j \Vert}
$$

### Multiple Springs

当需要处理多根弹簧组成的系统时，我们需要通过迭代的方式来求解。最简单的方法是对于每根弹簧单独求解，然后依次更新弹簧两端的位置并不断迭代，这种求解方法称为**Gauss-Seidel方法(Gauss-Seidel Approach)**：

<div align=center>
<img src="https://i.imgur.com/MbSP2tr.png" width="50%">
</div>

通常情况下我们无法保证迭代后一定能够满足所有的约束，但随着迭代次数的增加系统的约束情况会不断改善。需要注意的是Gauss-Seidel方法的效果与弹簧的顺序有很大的关系，弹簧的顺序不仅会影响收敛速度，还会影响最终的优化结果。

我们可以使用**Jacobi方法(Jacobi Approach)**来改善Gauss-Seidel方法依赖于弹簧顺序的问题。在Jacobi方法中会先保存每个顶点的更新量，然后对所有更新量取平均再更新弹簧顶点的位置：

<div align=center>
<img src="https://i.imgur.com/9ULW7XP.png" width="60%">
</div>

Jacobi方法的缺点在于它的收敛速度要小于Gauss-Seidel方法，但它不依赖于弹簧的计算顺序而且容易并行，因此Jacobi方法的应用更为广泛。

### Position Based Dynamics

在此基础上我们就可以设计算法来解决布料的仿真问题。我们首先来介绍**position based dynamics(PBD)**方法，它的做法非常直观：我们首先按照一般的质点系统来更新质点的位置和速度，然后利用Gauss-Seidel方法或是Jacobi方法考虑系统的约束，最后利用更新后的位置来更新质点的运动状态：

<div align=center>
<img src="https://i.imgur.com/qRX0pEM.png" width="45%">
</div>

PBD的缺陷在于它不是一个完全基于物理的方法，整个系统的弹性实际上是由迭代的次数以及网格的密度来决定：迭代次数越多、网格越密系统的弹性就越大。

PBD算法的优势在于它容易实现且易于并行，在网格分辨率比较低的情况下有非常快的收敛速度，而且除了布料模拟外也可以应用在其他类型的约束上；但它的缺点在于它不是基于物理的方法，因此得到的不是一个完全准确的解，同时在网格分辨率较高时计算效率会比较低。

## Projective Dynamics

## Reference

- [Lecture 6: Constrained Approaches: PBD, PD and others](https://www.bilibili.com/video/BV12Q4y1S73g?p=6)
- [Hierarchical Position Based Dynamics](https://matthias-research.github.io/pages/publications/hpbd.pdf)