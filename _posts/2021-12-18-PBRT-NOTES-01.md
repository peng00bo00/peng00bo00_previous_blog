---
layout: article
title: PBRT读书笔记01-Primitives and Intersection Acceleration
tags: ["PBRT", "Rendering", "CG"]
key: PBRT-01
aside:
  toc: true
sidebar:
  nav: PBRT
---

> 这个系列是[Physically Based Rendering:From Theory To Implementation](https://pbr-book.org/)的读书笔记，本节主要介绍光线求交的加速数据结构。
<!--more-->

在**光线追踪(ray tracing)**的框架中最基本的运算是光线与场景中物体(三角网格)求交。如果直接使用循环来计算的话每条光线的计算复杂度是$O(n)$，这会导致整个渲染过程非常的低效。注意到在大多数情况下对任意的一条光线在计算相交时它最多只会和场景中的极小部分三角形相交，因此我们可以设计出更高效的数据结构来管理渲染的场景，使得在每次计算时可以忽略场景中大部分无关的三角形。这样的加速数据结构一般可以分为基于**空间划分(spatial subdivision)**的数据结构以及基于**包围盒(bounding boxes)**的数据结构。前者的代表是**kd树(kd-tree)**，而后者的代表是**BVH(bounding volume hierarchies)**。

## Bounding Volume Hierarchies

在BVH我们使用bounding box来表示场景中的每一个三角形，每个bounding box都是与世界坐标系对齐的长方体**(axis-aligned bounding box, AABB)**，因此可以高效地计算光线与AABB是否相交。显然如果光线不和AABB相交那更不可能和内部的三角形相交，因此在计算和三角形求交前需要判断光线和AABB的相交情况，如果光线和AABB相交则进一步计算是否和三角形相交。除此之外BVH还使用一棵二叉树来把场景中的三角形组织起来，每个三角形都存储在二叉树的叶节点中，这样理论上在遍历三角形时每次可以跳过一半数量的三角形，进一步提高光线求交的效率。

<div align=center>
<img src="https://pbr-book.org/3ed-2018/Primitives_and_Intersection_Acceleration/Primitives%20and%20hierarchy.svg" width="50%">
</div>

### BVH Construction

### The Surface Area Heuristic

### BVH Traversal

## Kd-Tree Accelerator

除了BVH外还可以使用kd树来表示场景中的三角网格。不过在实践中发现使用kd树的计算效率一般会低于BVH，因此目前的各种框架基本不会使用kd树来管理场景。这里就先不介绍kd树相关的内容了，等后面有空的时候再补上。

## Reference

- [4 Primitives and Intersection Acceleration](https://pbr-book.org/3ed-2018/Primitives_and_Intersection_Acceleration)