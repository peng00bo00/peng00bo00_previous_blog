---
layout: article
title: Shape Analysis课程笔记12-The Laplacian Operator
tags: ["Shape Analysis", "Geometry Processing", "CG"]
key: SA-12
aside:
  toc: true
sidebar:
  nav: SA
---

> 这个系列是[MIT 6.838: Shape Analysis](https://groups.csail.mit.edu/gdpgroup/6838_spring_2021.html)的同步课程笔记。本课程会介绍几何方法在图形学、机器学习、计算机视觉、医疗图像以及建筑设计等相关领域的原理和应用。本节主要介绍Laplace算子的相关概念。
<!--more-->

**Laplace算子(Laplacian operator)**在数学和物理等相关领域中有着大量的应用。在几何处理中，我们可以利用Laplace算子将几何形状变换到频域然后从频谱的角度进行分析，这样的方法称为**spectral geometry**。

<div align=center>
<img src="https://i.imgur.com/3ow9HlK.png" width="80%">
<img src="https://i.imgur.com/vigcdRI.png" width="80%">
</div>

在本节课中我们会从简单的情况入手逐渐揭示Laplace算子在不同几何对象上的意义和应用。

<div align=center>
<img src="https://i.imgur.com/aDAWhdC.png" width="80%">
</div>

不过在具体介绍Laplace算子之前我们先回忆一下[线性算子](/2022/08/04/SA-NOTES-02.html#two-roles-for-matrices)的概念。当算子满足分配律和数乘时就称其是一个线性算子，比如说矩阵就是一个典型的线性算子。

<div align=center>
<img src="https://i.imgur.com/z4PEqlU.png" width="80%">
</div>

使用线性算子的一个优势在于我们可以不再受限于空间的维度，线性算子可以自然地推广到无穷维的空间上。

<div align=center>
<img src="https://i.imgur.com/wEVLGL2.png" width="80%">
</div>

同时矩阵的谱定理对于线性算子也有相应的推广。

<div align=center>
<img src="https://i.imgur.com/4U4MOPn.png" width="80%">
</div>

## Line Segments

### 1D Spring Network

首先考虑一维的情况。假设有一维质点弹簧系统，其中每个质点的质量为$m$，质点数为$n+1$，弹簧刚度为$k$。我们固定两端质点使其无法移动，

<div align=center>
<img src="https://i.imgur.com/kN691J5.png" width="80%">
</div>

根据牛顿运动定律，每个质点的运动方程可以表示为：

$$
\begin{aligned}
F &= m \cdot a = m \cdot \frac{d^2 u_i}{d t^2} \\
&= k (u_{i+1} - u_i) + k (u_{i-1} - u_i) \\
&= k (u_{i+1} + u_{i-1} - 2 u_i)
\end{aligned}
$$

整理之后可以得到线性系统：

$$
U'' (t) = -k L \ U(t)
$$

$$
L = 
\begin{bmatrix}
 2 &-1 \\
-1 & 2 &-1 \\ 
   &   & \ddots & \\
   &   &     -1 & 2 &-1 \\
   &   &        &-1 & 2
\end{bmatrix}
$$

对于微分项我们使用差分来进行近似：

$$
\frac{d^2 u}{d x^2} \approx \frac{\frac{u_{i+1} - u_i}{h} - \frac{u_i - u_{i-1}}{h}}{h}
= \frac{u_{i+1} + u_{i-1} - 2u_i}{h^2}
$$

这样线性算子$L$可以理解为求二阶导数：

$$
L \approx - \frac{d^2}{d x^2}
$$

此时求解运动方程相当于求解**偏微分方程(PDE)**：

$$
\frac{\partial^2 U}{\partial t^2} = c^2 \ \frac{d^2 U}{d x^2}
$$

上式即为一维**波动方程(wave equation)**，它描述了质点弹簧系统的振动。

<div align=center>
<img src="https://i.imgur.com/o8Tx6q5.png" width="80%">
</div>

波动方程更常见的形式为：

$$
\frac{\partial^2 u}{\partial t^2} - \frac{\partial^2 u}{\partial x^2} = 0
$$

<div align=center>
<img src="https://i.imgur.com/H0YWVf4.png" width="80%">
</div>

### Minus Second Derivative Operator

我们定义算子$L[\cdot]: u \rightarrow - \frac{\partial^2 u}{\partial x^2}$，可以证明它是一个(半)正定算子。

<div align=center>
<img src="https://i.imgur.com/vvlKdeq.png" width="80%">
</div>

对于离散的情况，$L$即为上面定义的矩阵。对于任意向量$u$有：

$$
\begin{aligned}
u^T L u &= \sum_i u_i (Lu)_i \\
&= \sum_i u_i (-u_{i-1} + 2 u_i - u_{i+1}) \\
&= 2 \sum_i u_i^2 - 2 \sum_i u_{i} u_{i-1} \\
&= \sum_i u_i^2 + \sum_i u_{i-1}^2 - 2 \sum_i u_{i} u_{i-1} \\
&= \sum_i (u_i - u_{i-1})^2 \\
&\geq 0
\end{aligned}
$$

而对于连续的情况则有：

$$
\begin{aligned}
\langle u, L[u] \rangle &= \int_a^b u(x) \cdot - \bigg( \frac{\partial^2 u}{\partial x^2}  \bigg) \ dx \\
&= \bigg[ - \frac{\partial u}{\partial x} \cdot u \bigg]_a^b + \int_a^b \frac{\partial u}{\partial x} \cdot \frac{\partial u}{\partial x} \ dx \\
&= \int_a^b \bigg( \frac{\partial u}{\partial x} \bigg)^2 \ dx \\
&\geq 0
\end{aligned}
$$

<div align=center>
<img src="https://i.imgur.com/IAQW26p.png" width="80%">
</div>

### Eigenfuctions of Second Derivative Operator

除了半正定外，在连续情况下算子$L$还有类似于矩阵特征向量的概念，称为**特征函数(eigenfunction)**。容易验证$L$的特征函数和对应特征值为：

$$
\phi_k (x) = \sqrt{\frac{2}{l}} \sin \bigg( \frac{\pi k x}{l} \bigg)
$$

$$
\lambda_k = \bigg( \frac{\pi k}{l} \bigg)^2
$$

而且不同特征函数之间是相互正交的：

$$
\langle \phi_k, \phi_m \rangle = \delta_{km}
$$

<div align=center>
<img src="https://i.imgur.com/52FzrMt.png" width="80%">
</div>

利用特征向量(函数)的正交性，我们可以对位移向量(函数)进行分解。对于离散情况，根据谱定理有：

$$
U(t) = \sum_i U^i(t) \phi_i
$$

其中$U^i(t)$为随时间变化的系数。带入微分方程可以得到：

$$
\begin{aligned}
\sum_i (U^i)'' (t) \ \phi_i &= -k L \ \sum_i U^i(t) \ \phi_i \\
&= -k \ \sum_i U^i(t) \ \lambda_i \phi_i
\end{aligned}
$$

进一步有：

$$
(U^i)'' (t) = -k \ U^i(t) \ \lambda_i
$$

因此我们只需要求解$n$个**常微分方程(ODE)**就可以得到波动方程的解。具体地，每个常微分方程的解为：

$$
U^i (t) = a^i \sin (\sqrt{k \lambda_i} t) + b^i \cos (\sqrt{k \lambda_i} t)
$$

这表示我们可以通过$L$矩阵的特征值与特征向量来计算波动方程的闭式解，而对于连续的情况也有类似的结论。

<div align=center>
<img src="https://i.imgur.com/ro3sunj.png" width="80%">
</div>

## Regions in $\mathbb{R}^n$

### Typical Notation

在二维平面上同样存在波动方程，它描述了平面上的振动。其中算子$\Delta$即为二维平面上的Laplace算子。

$$
\frac{\partial^2 u}{\partial t^2} = - \Delta u
$$

<div align=center>
<img src="https://i.imgur.com/BslD5Jw.png" width="80%">
</div>

Laplace算子有很多种定义方式，其中最经典的是使用梯度的散度来定义它。

<div align=center>
<img src="https://i.imgur.com/AV1quBO.png" width="80%">
</div>

### Intrinsic Operator

Laplace算子的一个重要性质是它与坐标变换无关。记坐标变换前的函数为$f(x)$，变换后的函数为$g(x) = f(R x + t)$，我们可以证明刚体变换后Laplace算子的效果是一样的：

$$
\frac{\partial}{\partial x^i} = \sum_j \frac{\partial y^j}{\partial x^i} \frac{\partial}{\partial y^j}  = \sum_j R_{ji} \ \frac{\partial}{\partial y^j}
$$

$$
\nabla_x = R^T \nabla_y
$$

因此，

$$
\Delta_x = -\nabla_x^T \ \nabla_x = -\nabla_y R \ R^T \nabla_y = \Delta_y
$$

<div align=center>
<img src="https://i.imgur.com/1P03Le8.png" width="80%">
</div>

### Dirichlet Energy

Laplace算子可以描述函数的光滑性。我们定义函数的**Dirichlet能量(Dirichlet energy)**为梯度的大小(范数)在区域$\Omega$上的积分：

$$
E[u] = \frac{1}{2} \int_\Omega \Vert \nabla u (\mathbf{x}) \Vert_2^2 \ d A(\mathbf{x})
$$

直观来看，Dirichlet能量越小表示函数在区域中的变化越平缓，函数也就越光滑。能够证明在给定边界条件下最小化Dirichlet能量等价于求解Laplace方程：

$$
\min_{u} E[u] \Leftrightarrow \Delta u = 0
$$

<div align=center>
<img src="https://i.imgur.com/MutWbwf.png" width="80%">
</div>

这里我们简单证明一下：

$$
\begin{aligned}
E[u] &= \frac{1}{2} \int_\Omega \Vert \nabla u (\mathbf{x}) \Vert_2^2 \ d A(\mathbf{x}) \\
&= \frac{1}{2} \int_\Omega \nabla u \cdot \nabla u \ d A(\mathbf{x}) \\
&= \frac{1}{2} \oint_{\partial \Omega} \dots \ dl - \frac{1}{2} \int_\Omega u (\mathbf{x}) \nabla \cdot \nabla u (\mathbf{x}) \ d A(\mathbf{x}) \\
&= \frac{1}{2} \int_\Omega u(\mathbf{x}) \Delta u(\mathbf{x}) \ d A(\mathbf{x}) + \text{boundary term} \\
&= \frac{1}{2} \langle u, \Delta u \rangle + \text{boundary term}
\end{aligned}
$$

接下来利用variational calculus来处理内积项的极值问题。假设函数$u$即为所求，我们在$u$上添加扰动$w$得到新的Dirichlet能量$E[u + hw]$，其中$h$为步长且扰动$w$满足边界条件$w_{\partial \Omega} = 0$。由于$u$为最优函数，扰动后的Dirichlet能量需要满足：

$$
\frac{d}{d h} E[u + hw] \bigg\vert_{h=0} = \frac{d}{d h} \bigg[ \frac{1}{2} \int_\Omega (u+hw) \ \Delta (u+hw) \ d A \bigg] = 0
$$

对Dirichlet能量进行展开可以得到：

$$
\begin{aligned}
\frac{d}{d h} E[u + hw] \bigg\vert_{h=0} &= \frac{d}{d h} \bigg[ \frac{1}{2} \int_\Omega (u+hw) \ \Delta (u+hw) \ d A \bigg] \\
&= \frac{1}{2} \int_\Omega \bigg[ w \ \Delta u + u \ \Delta w \bigg] \ d A \\
&= \int_\Omega w \ \Delta u \ d A
\end{aligned}
$$

这表示对于任意扰动$w$，$\Delta u$需要恒为0。即在$\Omega$内部$u$需要满足Laplace方程：

$$
\Delta u \equiv 0
$$

<div align=center>
<img src="https://i.imgur.com/kPyvjlk.png" width="80%">
</div>

实际上满足Laplace方程的函数也称为**调和函数(harmonic function)**，它们有很多优雅的几何性质。

<div align=center>
<img src="https://i.imgur.com/wxXpREP.png" width="80%">
<img src="https://i.imgur.com/JFiEx4R.png" width="80%">
</div>

### Positivity, Self-Adjointness

Laplace算子还满足正定性和自伴随性质，因此可以看成正定矩阵以及自伴随矩阵在函数空间中的推广：

$$
\begin{aligned}
\langle f, \Delta f \rangle &= - \int_\Omega f(\mathbf{x}) \ \nabla \cdot \nabla f(\mathbf{x}) \ dA \\
&= \int_\Omega \Vert \nabla f(\mathbf{x}) \Vert_2^2 \ dA \\
&\geq 0
\end{aligned}
$$

$$
\begin{aligned}
\langle f, \Delta g \rangle &= - \int_\Omega f(\mathbf{x}) \ \nabla \cdot \nabla g(\mathbf{x}) \ dA \\
&= \int_\Omega \nabla f(\mathbf{x}) \cdot \nabla g(\mathbf{x}) \ dA \\
&= \langle \Delta f, g \rangle
\end{aligned}
$$

<div align=center>
<img src="https://i.imgur.com/7umuHmv.png" width="80%">
</div>

### Laplacian Eigenfunctions

Laplace算子的特征方程与Dirichlet能量也有一定的联系，实际上小特征值对应的特征函数具有比较小的Dirichlet能量。

<div align=center>
<img src="https://i.imgur.com/r1v4vqG.png" width="80%">
</div>

有时我们需要固定$\Omega$内的一些点然后求解Laplace方程，这种情况下可能会导致一些病态的问题。

<div align=center>
<img src="https://i.imgur.com/r1v4vqG.png" width="80%">
</div>

## Graphs

## Surfaces/Manifolds

## Reference

- [Lecture 12-13：The Laplacian operator on intervals, regions, graphs, and manifolds](https://www.youtube.com/watch?v=VZMZUeIVUuA&list=PLQ3UicqQtfNtUcdTMLgKSTTOiEsCw2VBW&index=16)
- [Lectures 13 (extra content): Divergence of tangent vector fields](https://www.youtube.com/watch?v=7hTd6aVfAvQ&list=PLQ3UicqQtfNtUcdTMLgKSTTOiEsCw2VBW&index=17)
- [The Laplacian Operator](https://groups.csail.mit.edu/gdpgroup/assets/6838_spring_2021/8_laplacian_operator.pdf)
- [Chapter 9：The Laplacian Operator](https://groups.csail.mit.edu/gdpgroup/assets/6838_spring_2021/chapter9.pdf)