---
layout: article
title: PBRT读书笔记05-Reflection Models
tags: ["PBRT", "Rendering", "CG"]
key: PBRT-05
aside:
  toc: true
sidebar:
  nav: PBRT
---

> 这个系列是[Physically Based Rendering: From Theory To Implementation](https://pbr-book.org/)的读书笔记，本节主要介绍反射模型。
<!--more-->

## Basic Terminology

我们能够看到物体的本质原因是物体反射了光，因此反射模型对于渲染出正确的图像至关重要。在[Surface Reflection](/2021/12/19/PBRT-NOTES-02.html#surface-reflection)一节中我们介绍过BRDF的概念，它表示在$\omega_o$方向上反射光与$\omega_i$方向上接收光的比值。除了BRDF外，对于透明材质光线还会出现透射的情况，描述这种现象的函数称为**BTDF**。在PBRT中我们使用**散射(scattering)**将反射和透射统一起来，这样描述光线和材料表明相互作用的函数称为**BSDF**。

### Reflection Categories

首先来考虑反射的情况。在PBRT中我们将反射分成4种不同的类型：**漫反射(diffuse)**、**光泽镜面反射(glossy specular)**、**完美镜面反射(perfect specular)**以及**反向反射(retro-reflective)**。其中漫反射表示物体接收光线后再各个方向上都具有相同的反射；光泽镜面反射表示光线的反射会聚集在一定的范围上；完美镜面反射则更加严格，它表示物体反射的光线只会出现在一个确定的方向上；而反向反射则表示反射的方向与入射方向在一个区域内。现实中的反射现象可以看作以上四种反射类型的组合，它们的示意图如下：

<div align=center>
<img src="https://i.imgur.com/C0wb67G.jpg" width="80%">
</div>

同时还需要注意的是反射材料的方向性。现实生活中大部分材料是**各向同性(isotropic)**的，对于各向同性材料反射只和入射光线与法线的夹角有关，当入射光线绕法线旋转时反射的能量不变；而对于**各项异性(anisotropic)**材料，当入射光线绕法线旋转时反射的能量也会同时发生变化，在渲染时要格外注意。生活中常见的各项异性材料包括拉丝后的金属(brushed metal)、布料等等。

### Geometric Setting

PBRT在考虑反射时会在光线与材料交点的局部坐标系中进行计算，这个局部坐标系称为**着色坐标系(shading coordinate system)**。这样在进行计算时首先会把入射光线放在着色坐标系中并计算反射光线，然后再把反射光线转换到世界坐标系中进行后续的计算。

着色坐标系可以通过三个正交的向量$(\mathbf{s}, \mathbf{t}, \mathbf{n})$来定义，其中$\mathbf{n}$为交点处的法线方向，另外两个方向则是局部坐标系的x轴和y轴。

<div align=center>
<img src="https://pbr-book.org/3ed-2018/BSDF%20coordinate%20system.svg" width="50%">
</div>

在计算方向时我们往往会使用球坐标来代替直角坐标系，此时球面上的方向可以使用两个角度$(\theta, \phi)$来表示。其中$\theta$表示该方向与z轴的夹角，$\phi$则是方向投影后和x轴的夹角。

<div align=center>
<img src="https://pbr-book.org/3ed-2018/BSDF%20theta%20phi%20angles.svg" width="50%">
</div>

还需要注意的是PBRT在计算反射时有一些假定：

1. 入射光线$\omega_i$和反射光线$\omega_o$在计算时都需要进行单位化，而且需要指向物体表面外侧；
2. PBRT中默认法向$\mathbf{n}$指向物体外侧，这样便于判断光线是射入还是射出透射的物体：光线方向与$\mathbf{n}$在同一半球时表示射入，在相反的半球上时表示射出；
3. 求交计算出的坐标系与着色坐标系可能是不同的，在计算凹凸贴图时会修改求交计算的坐标系；
4. BRDF和BTDF不会假定入射光线$\omega_i$和反射光线$\omega_o$在同一半球上。

## Specular Reflection and Transmission

对于完美镜面反射的情况我们可以通过几何光学来表示入射光线和出射光线的关系：

$$
\theta_o = \theta_i
$$

$$
\phi_o = \phi_i + \pi
$$

对于透射的情况，$\phi_t$与$\phi_i$的关系与反射一致，但$\theta_t$则需要满足**折射定律(Snell's law)**：

$$
\eta_i \sin \theta_i = \eta_t \sin \theta_t
$$

其中$\eta$为**折射率(refractive index)**。在通常情况下不同波长的光线具有不同的折射率，这就导致入射光线发生折射时会散射到不同的方向上，这种现象称为**色散(dispersion)**。但是在图形学中一般会忽略这种现象，假定不同波长的光线都具有相同的折射率。

### Fresnel Reflectance

### Specular Transmission

## Lambertian Reflection

## Microfacet Models

## Reference

- [8 Reflection Models](https://pbr-book.org/3ed-2018/Reflection_Models)