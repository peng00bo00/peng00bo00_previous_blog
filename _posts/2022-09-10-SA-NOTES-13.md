---
layout: article
title: Shape Analysis课程笔记13-Discrete Laplacian Operators
tags: ["Shape Analysis", "Geometry Processing", "CG"]
key: SA-13
aside:
  toc: true
sidebar:
  nav: SA
---

> 这个系列是[MIT 6.838: Shape Analysis](https://groups.csail.mit.edu/gdpgroup/6838_spring_2021.html)的同步课程笔记。本课程会介绍几何方法在图形学、机器学习、计算机视觉、医疗图像以及建筑设计等相关领域的原理和应用。本节主要介绍离散曲面上的Laplace算子。
<!--more-->

## Discretizing the Laplacian

在上一节课中我们介绍了Laplace算子在不同作用域下的定义和性质。而对于几何处理问题，我们更关心如何在离散曲面上来定义Laplace算子。我们希望离散情况下的Laplace算子能够近似它在连续情况下的各种性质。

<div align=center>
<img src="https://i.imgur.com/ZFrIwUL.png" width="80%">
</div>

回忆[$\mathbb{R}^n$上Laplace算子](/2022/09/08/SA-NOTES-12.html#regions-in-mathbbrn)可以定义为函数对于坐标轴二阶导数的和，对于曲面的情况可以使用类似的方法进行定义。

<div align=center>
<img src="https://i.imgur.com/lg3CyEg.png" width="80%">
</div>

实际上数学家已经推导过曲面上的Laplace算子。不过它的表达式非常复杂，在绝大多数情况下我们都会尽量避免直接使用它。

<div align=center>
<img src="https://i.imgur.com/BmG9Bef.png" width="80%">
</div>

在离散曲面上定义Laplace算子的难点在于它是一个微分算子，对于很多离散几何对象有时我们往往很难去定义各种微分运算。

<div align=center>
<img src="https://i.imgur.com/tF1uV24.png" width="80%">
</div>

本节课中我们会利用**有限单元法(finite element method, FEM)**来推导Laplace算子的近似形式。

<div align=center>
<img src="https://i.imgur.com/clEiohC.png" width="80%">
</div>

## Laplacian from FEM

### Integration by Parts

在推导离散Laplace算子之前首先简要介绍一下FEM的基本思想。回忆到目前为止我们大量使用了分部积分的技术来处理各种积分问题。

<div align=center>
<img src="https://i.imgur.com/Dovuj8Y.png" width="80%">
</div>

对于Laplace算子而言，通过分部积分可以把二阶微分算子转换为一阶微分(梯度)。在大多数情况下梯度的计算要远比二阶微分要容易得多，有时我们甚至可以利用函数的各种性质来避免一些计算。

<div align=center>
<img src="https://i.imgur.com/9DvDxHf.png" width="80%">
<img src="https://i.imgur.com/HtXiAzh.png" width="80%">
</div>

### Poisson Equation

FEM的本质是把微分方程转换为代数方程进行求解。以**泊松方程(Poisson equation)**为例，一维泊松方程可以表示为：

$$
\Delta f = g
$$

显然在无穷的函数空间中求解泊松方程是非常困难的。这里我们引入一系列基函数：

$$
\phi_1(x), \phi_2(x), \dots \phi_k(x) : \mathcal{M} \rightarrow \mathbb{R}
$$

因此可以对函数进行分解：

$$
f(x) = \sum_k v^k \phi_k(x)
$$

$$
g(x) = \sum_k w^k \phi_k(x)
$$

这样我们只需要求解系数$v^k$和$w^k$即可：

$$
\sum_k v^k \Delta \phi_k(x) = \sum_k w^k \phi_k(x)
$$

直接求解上式仍然是非常困难的。这里我们引入**测试函数(test function)**的概念，放松条件仅要求等式两端与测试函数的内积必须相等。测试函数的一种常见选取方法是选择一个基函数$\phi_l$，此时有：

$$
\sum_k v^k \int \phi_l(x) \ \Delta \phi_k(x) \ dx = \sum_k w^k \int \phi_l(x) \phi_k(x) \ dx 
$$

通过轮换测试函数$\phi_l$可以得到一系列的线性方程，其矩阵形式为：

$$
L \mathbf{v} = M \mathbf{w}
$$

$$
L_{kl} = \int \phi_l(x) \ \Delta \phi_k(x) \ dx
$$

$$
M_{kl} = \int \phi_l(x) \phi_k(x) \ dx
$$

这样原始的微分方程就转换为代数方程，我们也就可以使用计算机来进行求解。

<div align=center>
<img src="https://i.imgur.com/OqJcqnq.png" width="80%">
</div>

### Galerkin FEM Approach

实际上上面将微分方程转换为代数方程的方法称为**Galerkin FEM approach**，它的核心步骤包括两步：使用基函数对目标函数进行分解，然后通过函数内积来构造线性系统。

<div align=center>
<img src="https://i.imgur.com/HdZIn6Y.png" width="80%">
</div>

除此之外Galerkin方法也可以从variational calculus的角度来进行理解，泊松方程等价于求解如下优化问题：

$$
\min_{f: \mathcal{M} \rightarrow \mathbb{R}} \int \bigg[ \frac{1}{2} \Vert \nabla f \Vert_2^2 - f \cdot g \bigg] \ d x
$$

通过基函数分解，优化问题可以整理为：

$$
\begin{aligned}
&\min_{v^1, \dots, v^k} \ \int \bigg[ \frac{1}{2} \big\Vert \sum_k v^k \nabla \phi_k \big\Vert_2^2 - \sum_{k, l} v^k w^l \phi_k \phi_l \bigg] \ d x \\
=
&\min_{v^1, \dots, v^k} \ \int \frac{1}{2} \mathbf{v}^T L \mathbf{v} - \mathbf{v}^T M \mathbf{w} \ d x \\
&\min_{\mathbf{v} \in \mathbb{R}^k} \ \frac{1}{2} \mathbf{v}^T L \mathbf{v} - \mathbf{v}^T M \mathbf{w}
\end{aligned}
$$

而它的解恰为线性系统的解：

$$
L \mathbf{v} = M \mathbf{w}
$$

<div align=center>
<img src="https://i.imgur.com/4RV6pHF.png" width="80%">
</div>

需要说明的是Galerkin方法并不是推导FEM唯一的方法，在不同的工程问题中还有很多将微分方程转换为代数方程的方法。

<div align=center>
<img src="https://i.imgur.com/OuhJ8DI.png" width="80%">
</div>

### $L^2$ Dual of a Function

从函数的角度来进行考虑，Galerkin方法实际上是把函数$f$通过一个算子$\mathcal{L}$转换为对偶形式$\mathcal{L}[f]$，然后利用测试函数$g$来进行求解原始的微分方程。

<div align=center>
<img src="https://i.imgur.com/dUcLSt9.png" width="80%">
</div>

通过选择合适的测试函数$g$我们还可以从对偶形式来恢复函数$f$。

<div align=center>
<img src="https://i.imgur.com/6VDuBBS.png" width="80%">
</div>

当我们使用Laplace算子作为对偶形式时甚至可以避免直接计算函数的二阶微分。

<div align=center>
<img src="https://i.imgur.com/5F0cuGz.png" width="80%">
</div>

## Laplacian on Mesh

总结一下，使用Galerkin方法构造和求解FEM问题的核心在于选择合适的函数空间以及测试函数，而且在大多数情况下这两个函数空间是相同的。

<div align=center>
<img src="https://i.imgur.com/LKM8X7F.png" width="80%">
<img src="https://i.imgur.com/Lv10Nab.png" width="80%">
</div>

## Reference

- [Lecture 14：Laplacian operators via first-order Galerkin finite elements (FEM)](https://www.youtube.com/watch?v=ZtNr184BFlc&list=PLQ3UicqQtfNtUcdTMLgKSTTOiEsCw2VBW&index=18)
- [Lecture 14 (extra content): A simple Laplacian on point clouds](https://www.youtube.com/watch?v=HAPTxiRIZMg&list=PLQ3UicqQtfNtUcdTMLgKSTTOiEsCw2VBW&index=19)
- [Discrete Laplacian Operators](https://groups.csail.mit.edu/gdpgroup/assets/6838_spring_2021/9_discrete_laplacians.pdf)
- [Chapter 9：The Laplacian Operator](https://groups.csail.mit.edu/gdpgroup/assets/6838_spring_2021/chapter9.pdf)