---
layout: article
title: GAMES104课程笔记21-Dynamic Global Illumination and Lumen
tags: ["GAMES104", "CG"]
key: GAMES104-21
aside:
  toc: true
sidebar:
  nav: GAMES104
---

> 这个系列是GAMES104-现代游戏引擎：从入门到实践([GAMES 104: Modern Game Engine-Theory and Practice](https://games104.boomingtech.com/en/))的同步课程笔记。本课程会介绍现代游戏引擎所涉及的系统架构、技术点以及引擎系统相关的知识。本节课主要介绍现代游戏引擎中的全局光照技术。
<!--more-->

## Global Illumination

### The Rendering Equation

**全局光照(global illumination, GI)**是渲染中的重要问题。在介绍GI在游戏引擎的实现方法前我们先回顾一下**渲染方程(the rendering equation)**：

<div align=center>
<img src="https://i.imgur.com/QErTxYh.png" width="80%">
</div>

可以说一切渲染问题的本质在于求解渲染方程，而求解渲染方程的难点在于方程自身的递归形式。当场景中的物体被光源照亮后，被照亮的物体又会成为新的光源同时照亮其它物体。以Cornell box为例，来自屋顶的灯光会照亮左右两侧红色和绿色的墙壁，然后墙壁反射的光线又会照亮盒子使得盒子的两侧呈现红色或是绿色，这样的现象称为**color bleeding**。

<div align=center>
<img src="https://i.imgur.com/2hKEcOR.png" width="80%">
<img src="https://i.imgur.com/wokjNvq.png" width="80%">
</div>

在复杂的游戏场景中通过GI会极大地提升画面表现力。

<div align=center>
<img src="https://i.imgur.com/guC0wgq.png" width="80%">
</div>

### Monte Carlo Integration

作为积分方程，求解渲染方程的经典方法是**Monte Carlo积分(Monte Carlo integration)**。对于可积函数$f(x)$，我们可以通过采样的方法来逼近$f(x)$的积分。

<div align=center>
<img src="https://i.imgur.com/mXysFHr.png" width="80%">
<img src="https://i.imgur.com/huDj09j.png" width="80%">
</div>

**光线追踪(ray tracing)**算法的本质就是通过Monte Carlo积分来求解渲染方程。

<div align=center>
<img src="https://i.imgur.com/uXDJtP6.png" width="80%">
</div>

### Importance Sampling

Monte Carlo积分的效率和精度取决于如何设计采样的样本。当样本的数量比较少或是质量比较低时，通过光线追踪渲染出的图像往往会具有非常多的噪声。

<div align=center>
<img src="https://i.imgur.com/c6PYK0k.png" width="80%">
</div>

因此如何设计采样的分布对于提升渲染质量有着非常重要的意义，其中最简单的采样方法是均匀采样。

<div align=center>
<img src="https://i.imgur.com/zd0jVdV.png" width="80%">
</div>

现代高质量渲染的核心技术在于**重要性采样(importance sampling)**的大规模应用。重要性采样理论指出当我们的采样函数接近于被积函数时只需要相对少的样本就可以很好地近似被积函数的积分，而在计算Monte Carlo积分时只需要对样本按照pdf进行加权求和即可。

<div align=center>
<img src="https://i.imgur.com/FNRmpH1.png" width="80%">
<img src="https://i.imgur.com/bpna884.png" width="80%">
</div>

回到渲染方程中，被积函数包含余弦项$\cos \theta_i$，因此一个常见技巧是根据余弦项进行采样；类似地也可以按照BRDF来进行采样，这种采样方式对于光泽表面的物体往往有着更高的积分效率。

<div align=center>
<img src="https://i.imgur.com/mbKK3Re.png" width="80%">
<img src="https://i.imgur.com/BqLeQnj.png" width="80%">
<img src="https://i.imgur.com/QTDyg2I.png" width="80%">
</div>

## Reflective Shadow Maps

## Light Propagation Volumes

## Sparse Voxel Octree for Real-time Global Illumination

## Voxelization Based Global Illumination

## Screen Space Global Illumination

## Lumen

## Reference

- [Lecture 21：Dynamic Global Illumination and Lumen (Part I)](https://www.bilibili.com/video/BV1oe411u7DJ/?vd_source=7a2542c6c909b3ee1fab551277360826)
- [Lecture 21：Dynamic Global Illumination and Lumen (Part II)](https://www.bilibili.com/video/BV1Ya411g7Th/?spm_id_from=333.788&vd_source=7a2542c6c909b3ee1fab551277360826)