---
layout: article
title: GAMES103课程笔记07-Linear Finite Element Method
tags: ["GAMES103", "CG"]
key: GAMES103-07
aside:
  toc: true
sidebar:
  nav: GAMES103
---

> 这个系列是GAMES103：基于物理的计算机动画入门([GAMES 103: Intro to Physics Based Animation](http://games-cn.org/games103/))的同步课程笔记。本课程是计算机动画的入门课程，着重介绍各种基于物理的动画仿真模拟技术。本节课主要介绍有限元在物理仿真中的应用。
<!--more-->

## Linear Finite Element Method

### Deformation Gradient

**线性有限元(linear FEM)**是**有限单元法(FEM)**中最基本的形式。在linear FEM中我们使用三角形网格来表示物体，并且假设三角形内部任意点的运动可以使用一个线性变换来表示：

$$
\mathbf{x} = \mathbf{F} \mathbf{X} + \mathbf{c}
$$

式中$\mathbf{F} = \frac{\partial \mathbf{x}}{\partial \mathbf{X}}$称为**变形梯度(deformation gradient)**。同时不难发现对于三角形内部的任意两点$\mathbf{X}_a$、$\mathbf{X}_b$，它们构成的矢量在变形前后满足：

$$
\mathbf{x}_{ba} = \mathbf{x}_b - \mathbf{x}_a = (\mathbf{F} \mathbf{X}_b + \mathbf{c}) - (\mathbf{F} \mathbf{X}_a + \mathbf{c}) = \mathbf{F} \mathbf{X}_{ba}
$$

<div align=center>
<img src="https://i.imgur.com/iIhyR3p.png" width="80%">
</div>

因此我们可以利用三角形的两条边来计算变形梯度：

$$
\left\{
\begin{aligned}
& \mathbf{F} \mathbf{X}_{10} = \mathbf{x}_{10} \\
& \mathbf{F} \mathbf{X}_{20} = \mathbf{x}_{20}
\end{aligned}
\right.
\Rightarrow
\mathbf{F}
\begin{bmatrix}
\mathbf{X}_{10} & \mathbf{X}_{20}
\end{bmatrix}
= 
\begin{bmatrix}
\mathbf{x}_{10} & \mathbf{x}_{20}
\end{bmatrix}
$$

$$
\mathbf{F} = 
\begin{bmatrix}
\mathbf{x}_{10} & \mathbf{x}_{20}
\end{bmatrix}
\begin{bmatrix}
\mathbf{X}_{10} & \mathbf{X}_{20}
\end{bmatrix}^{-1}
$$

这样我们就可以利用三角形在变形前后的坐标来计算变形梯度。但需要注意的一点是这样计算出的变形梯度实际上同时包含了变形和旋转：即使三角形只进行了旋转而没有发生变形，我们仍然可以计算出一个变形梯度，此时$\mathbf{F}$等价于旋转矩阵。

<div align=center>
<img src="https://i.imgur.com/KJtUSqp.png" width="75%">
</div>

### Green Strain

显然我们希望求解出的变形能够与刚体变换无关。因此可以对$\mathbf{F}$进行SVD来分离出旋转：

$$
\mathbf{F} = \mathbf{U} \mathbf{D} \mathbf{V}^T
$$

其中$\mathbf{V}^T$和$\mathbf{D}$控制了变形的方向和大小，而$\mathbf{U}$为变形后的旋转与变形本身无关。

<div align=center>
<img src="https://i.imgur.com/94cuDLt.png" width="90%">
</div>

因此我们希望可以从$\mathbf{F}$中分离出$\mathbf{U}$。直接的方法是对$\mathbf{F}$进行SVD，但更常用的做法是利用$\mathbf{F}$构造出一个与$\mathbf{U}$无关的矩阵：

$$
\mathbf{G} = \frac{1}{2} (\mathbf{F}^T \mathbf{F} - \mathbf{I}) = \frac{1}{2} (\mathbf{V} \mathbf{D}^2 \mathbf{V}^T - \mathbf{I}) = 
\begin{bmatrix}
\varepsilon_{uu} & \varepsilon_{uv} \\
\varepsilon_{vu} & \varepsilon_{vv}
\end{bmatrix}
$$

上式中$\mathbf{G}$称为**Green应变张量(Green strain)**。显然在没有变形的情况下，Green应变张量为0；变形越大，Green应变张量越大。因此Green应变张量描述了物体的变形而且与旋转无关。同时注意到Green应变张量是一个对称阵，因此它只具有3个自由度。

### Strain Energy Density Function

有了变形后就可以定义系统的能量。我们定义面积微元上的变形能量为**能量密度(energy density)**$W(\mathbf{G})$，则三角形上的能量等于能量密度的积分：

$$
E = \int W(\mathbf{G}) d A
$$

对于linear FEM整个三角形上的变形是相同的，因此三角形的能量等于能量密度乘以三角形的面积：

$$
E = \int W(\mathbf{G}) d A = A^{\text{ref}} W(\varepsilon_{uu}, \varepsilon_{uv}, \varepsilon_{vv})
$$

在图形学中一般使用**Saint Venant-Kirchhoff Model(StVK)**来计算能量密度：

$$
W(\varepsilon_{uu}, \varepsilon_{uv}, \varepsilon_{vv}) = \frac{\lambda}{2} (\varepsilon_{uu} + \varepsilon_{vv})^2 + \mu (\varepsilon_{uu}^2 + \varepsilon_{vv}^2 + 2 \varepsilon_{uv}^2)
$$

其中$\lambda$和$\mu$称为**拉梅参数(Lamé parameters)**。

<div align=center>
<img src="https://i.imgur.com/qDU7zYy.png" width="80%">
</div>

对能量密度求导可以发现：

$$
\frac{\partial W}{\partial \mathbf{G}} = 
\begin{bmatrix}
\frac{\partial W}{\partial \varepsilon_{uu}} & \frac{\partial W}{\partial \varepsilon_{uv}} \\
\frac{\partial W}{\partial \varepsilon_{vu}} & \frac{\partial W}{\partial \varepsilon_{vv}} \\
\end{bmatrix}
=
\begin{bmatrix}
2 \mu \varepsilon_{uu} + \lambda \varepsilon_{uu} & 2 \mu \varepsilon_{uv} \\
2 \mu \varepsilon_{vu} & 2 \mu \varepsilon_{vv} + \lambda \varepsilon_{vv} \\
\end{bmatrix}
=
2 \mu \mathbf{G} + \lambda \text{tr}(\mathbf{G}) \mathbf{I} = \mathbf{S}
$$

其中$\mathbf{S}$称为**第二类Piola-Kirchhoff应力张量(second Piola-Kirchhoff stress tensor)**。

### Forces

## Finite Volume Method

## Hyperelastic Models

## Reference

- [Lecture 7: Other Constrained Methods and Linear Finite Element Method I](https://www.bilibili.com/video/BV12Q4y1S73g?p=7)