---
layout: article
title: GAMES104课程笔记07-Render Pipeline, Post-process and Everything
tags: ["GAMES104", "CG"]
key: GAMES104-07
aside:
  toc: true
sidebar:
  nav: GAMES104
---

> 这个系列是GAMES104-现代游戏引擎：从入门到实践([GAMES 104: Modern Game Engine-Theory and Practice](https://games104.boomingtech.com/en/))的同步课程笔记。本课程会介绍现代游戏引擎所涉及的系统架构、技术点以及引擎系统相关的知识。本节课主要介绍现代游戏引擎中的渲染管线以及其它常用的技术。
<!--more-->

## Ambient Occlusion

**环境光遮蔽(ambient occlusion, AO)**是现代游戏必备的渲染技术，通过AO可以获得更加丰富的光影变化以及更加立体的视觉感受。

<div align=center>
<img src="https://i.imgur.com/fgWRpwv.png" width="80%">
<img src="https://i.imgur.com/Lqb8MXU.png" width="80%">
</div>

从渲染方程的角度来看，AO的本质是计算网格上每个点在光照下的可见性。

<div align=center>
<img src="https://i.imgur.com/Bc9Fp0b.png" width="80%">
</div>

早期的AO是通过对网格进行预计算来实现，我们可以把顶点的可见性事先烘焙到网格信息中以便实际渲染时调用。这种方法目前在游戏工业中仍然有很多的应用。

<div align=center>
<img src="https://i.imgur.com/sAinfzq.png" width="80%">
</div>

### SSAO

显然这种AO方法只考虑的单个模型自身的几何信息，当把模型放置在场景中时是无法得到正确的AO效果的。为了克服这样的问题，人们提出了**SSAO**这种基于屏幕空间的AO算法。SSAO的处理方法是首先从相机出发渲染出一张深度图，然后对于深度图上的每一个像素我们在屏幕空间上找到该点对应的模型位置并在它的周围采样出$N$个点。利用这$N$个采样点以及深度图我们就可以估计该点处的遮挡关系，从而实现AO的效果。

<div align=center>
<img src="https://i.imgur.com/KzUvxuI.png" width="80%">
</div>

当然SSAO是一种近似方法，它本身是存在一些问题的。在SSAO的基础上人们又发展出了SSAO+算法，SSAO+没有在整个球体内进行采样而是根据顶点法向考虑法向对应的上半球上进行采样。这种改进克服了SSAO容易产生的整个游戏画面过暗的问题。

<div align=center>
<img src="https://i.imgur.com/WMTInR9.png" width="80%">
</div>

使用SSAO+实现的AO效果可见下图。SSAO相关方法的缺陷在于它只考虑了屏幕空间上的几何，这种简化在某些情况下会导致错误的结果。

<div align=center>
<img src="https://i.imgur.com/igPLdvy.png" width="80%">
<img src="https://i.imgur.com/BdM2lst.png" width="80%">
</div>

### HBAO

**HBAO**同样是基于屏幕空间的AO算法，它的思想是使用天顶角$\theta$的可见性来代替SSAO中的采样方法。我们可以通过对顶点法向上半球的方向通过ray marching的方式进行积分来估计它的可见性。

<div align=center>
<img src="https://i.imgur.com/ikaG0lR.png" width="80%">
<img src="https://i.imgur.com/O1ju9M4.png" width="80%">
</div>

### GTAO

上面介绍的几种算法都隐含地假设了顶点接收到来自不同方向上的光照是一致的，但实际上这种假设都没有考虑到渲染方程中的余弦项$\cos \theta$。**GTAO**补充了缺失的余弦项，此外对光线进行多次弹射的效果进行了拟合。

<div align=center>
<img src="https://i.imgur.com/BhAuMSY.png" width="80%">
<img src="https://i.imgur.com/1Pr7dlH.png" width="80%">
</div>

### Ray-Tracing Ambient Occlusion

当然，利用现代GPU的强大计算能力我们也可通过real time ray tracing的方式来计算AO。

<div align=center>
<img src="https://i.imgur.com/j6xbYJi.png" width="80%">
</div>

## Fog

## Anti-aliasing

## Post-process

## Reference

- [Lecture 07：Render Pipeline, Post-process and Everything I](https://www.bilibili.com/video/BV1kY411P7QM/?spm_id_from=333.788)