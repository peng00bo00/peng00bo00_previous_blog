---
layout: article
title: PBRT读书笔记10-Monte Carlo Integration
tags: ["PBRT", "Rendering", "CG"]
key: PBRT-10
aside:
  toc: true
sidebar:
  nav: PBRT
---

> 这个系列是[Physically Based Rendering: From Theory To Implementation](https://pbr-book.org/)的读书笔记，本节主要介绍Monte Carlo积分的相关知识。
<!--more-->

在渲染过程中我们经常需要去计算各种各样的高维数值积分。这些被积函数往往是十分复杂，甚至没有解析形式。计算这些函数的积分一般需要在积分区间进行采样，因此这种方法称为**Monte Carlo积分(Monte Carlo integration)**。

## Background and Probability Review

在正式介绍Monte Carlo积分前首先简要复习一下概率论和随机变量的相关知识。对于随机变量我们使用斜体$X$来表示，把某个函数$f$作用在$X$上时我们会得到一个新的随机变量$Y = f(X)$。离散型随机变量的**累计概率分布函数(cumulative distribution function, CDF)**定义为：

$$
P(x) = Pr(X \leq x)
$$

### Continuous Random Variables

在渲染中更为常用的是连续型随机变量，其中[0, 1)区间上均匀分布的随机变量记为$\xi$。$\xi$是一个非常重要的随机变量，利用$\xi$可以生成更加复杂分布的随机变量。我们定义连续型随机变量的**概率密度函数(probability density function, PDF)**为CDF的微分：

$$
p(x) = \frac{d \ P(x)}{d \ x}
$$

对于均匀分布的随机变量$\xi$，它的PDF为

$$
p(x) = 
\left\{
\begin{aligned}
& 1 & x \in [0, 1) \\
& 0 & \text{otherwise}
\end{aligned}
\right.
$$

需要注意的是任意PDF必须满足非负而且积分为1。在给定区间[a, b]上PDF的积分即为随机变量落在该范围上的概率：

$$
P(x \in [a, b]) = \int_a^b p(x) \ dx
$$

### Expected Values and Variance

我们定义函数$f$在给定概率分布$p(x)$上的**期望(expected value)**为$f(x)$与$p(x)$的积分：

$$
E_p [f(x)] = \int_D f(x) p(x) \ dx
$$

定义$f$的**方差(variance)**为$f(x)$偏离自身期望的程度：

$$
V[f(x)] = E \bigg[ \big( f(x) - E[f(x)] \big)^2 \bigg] = E[(f(x))^2] - E[f(x)]^2
$$

期望和方差的常用性质如下：

$$
E[a f(x)] = a E[f(x)]
$$

$$
E\bigg[ \sum_i f(x_i) \bigg] = \sum_i E[f(x_i)]
$$

$$
V[a f(x)] = a^2 V[f(x)]
$$

对于相互独立的随机变量，它们的方差具有可加性：

$$
\sum_i V[f(x_i)] = V \bigg[ \sum_i f(x_i) \bigg]
$$

## The Monte Carlo Estimator

## Sampling Random Variables

## Metropolis Sampling

## Transforming between Distributions

## 2D Sampling with Multidimensional Transformations

## Russian Roulette and Splitting

## Careful Sample Placement

## Bias

## Importance Sampling

## Reference

- [13 Monte Carlo Integration](https://pbr-book.org/3ed-2018/Monte_Carlo_Integration)